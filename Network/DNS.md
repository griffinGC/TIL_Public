# DNS

> https://openstory.tistory.com/46
>
> https://m.blog.naver.com/okaysungnam/221258245077
>
> https://m.blog.naver.com/okaysungnam/221258820743

- **영문으로된 도메인 이름을 숫자로된 IP 주소로 변환해주는 서버**

  - 반대로 IP 주소를 도메인으로 변경하기도 함

- 실제 구현하는 대표적인 서버 프로그램은 BIND

- DNS는 많은 **분산 계층 데이터베이스**로 구성됨

  - 단일을 사용하게 되면 아래와 같은 여러 문제 발생

    - 서버의 고장
    - 트래픽 양
    - 먼 거리의 중앙 집중 데이터 베이스
    - 유지 관리

  - 중앙 집중 데이터 베이스는 **확장성**이 없음

    - 그로 인해, 분산 계층 활용

      ![DNS_STRUCTURE](https://www.novell.com/documentation/dns_dhcp/dhcp_enu/graphics/dhc_002a.gif)

## 도메인 종류

### 전제조건

- 도메인을 사용하기 위해서는 호스트의 이름과  IP정보를 상위 도메인 네임서버에 등록해야 함
  - 비용을 내고 상위 도메인 네임서버의 주소정보 파일에 등록하고자 하는 호스트의 IP 주소와 이름을 저장하는 것
- 상위 도메인 네임서버에 등록이 되어야 도메인을 유효하게 사용 가능
- WWW는 3단계 혹은 4단계 도메인 뜻함

### 1단계 최상위 도메인 TLD (Top Level Domain)

- 최상위 도메인
- 주소로 볼때는 가장 끝에 오는 것들
- 국가 최상위 도메인과 일반 최상위 도메인으로 나뉨
  - kr, jp, cn 등등
  - 각국의 정보를 담은 약자로 정해져있기 때문에 일반 사용자들은 원하는 이름으로 도메인 등록 불가
- 기업은 com
- 네트워크 관련 제공자는 net
- 기관 혹은 단체는 org

### 2단계 차상위 도메인 SLD (Second Level Domain)

- 최상위 도메인 바로 아래에서 이름을 붙여서 사용하는 도메인
- co, go, or, ac

### 3단계 하위 도메인 (Sub-Level Domain)

- 도메인 관리자가 자유롭게 이름을 지정하여 만들 수 있는 도메인
- 일반 사용자들이 도메인을 등록하는 과정
- 하위 도메인과 쿠키 관련된 다른 문서확인



## DNS 서버 종류

### 캐시 DNS Server (Cache DNS Server)

- 도메인 계층 구조에 해당하지 않고, 별도 도메인을 가지고 있지 않음
- 도메인을 별도로 가지고 있지 않으므로 상위 도메인 네임 서버에 등록해서 사용하지 않음
- 호스트 컴퓨터에 대한 질의 내용만을 수행
- 주로 로컬 DNS 서버로 사용됨

### 최상위 도메인(TLD) 서버

- 상위 레벨 도메인(com, org, net, edu... )과 모든 국가의 상위 레벨 도메인(kr, uk, fr, ca, jp..)에 대한 TLD 서버
- TLD 서버들은 책임 DNS 서버들에 대한 IP 주소 제공

### 루트 DNS Server (Root DNS Server)

- 400개 이상의 루트 DNS 서버가 존재

### 책임 DNS 서버 (Authoritative DNS Server)

- 인터넷에 접근하기 쉬운 호스트를 가진 모든 기관은 호스트 네임을 ip 주소로 매핑하는 공개적인 DNS 레코드를 가짐
- 기관의 책임 DNS 서버는 이러한 DNS 레코드를 가지고 있음
  - 서비스 제공자의 책임 DNS 서버에 비용을 지불하고 레코드를 저장하게 할 수 있음

### 로컬 DNS 서버

- ISP들은 로컬 DNS 서버를 가짐
- ISP들은 로컬 DNS 서버로부터 IP주소를 호스트에게 전달
  - 즉, 로컬 DNS서버가 호스트에게 IP 주소 제공
- 호스트가 DNS 질의를 보내면, 질의는 먼저 프록시로 동작하는 로컬 DNS 서버에게 전달됨
  - 로컬 DNS 서버는 질의를 DNS 서버 계층으로 전달
  - 

---

## DNS 동작 흐름

- **질의와 응답은 UDP 연결과 53번 포트를 이용해서 수행됨**

1. 브라우저는 URL로부터 호스트 네임 추출, 호스트 네임을 DNS클라이언트(아직, 사용자)에 넘김

2. 사용자(DNS 클라이언트)는 DNS서버로 호스트 네임을 포함하는 질의를 보냄

   

#### DNS 캐싱 사용하지 않는 경우

- 반복적 질의와 재귀적 질의 사용

- EX. `WWW.NAVER.COM`

1. 클라이언트가 로컬 DNS 서버에 DNS 질의 메시지 전송
   - 질의에는 호스트네임 포함 (`WWW.NAVER.COM`)
2. 로컬 DNS 서버는 질의 메시지를 루트 DNS 서버에 전달
3. 루트 DNS 서버는 최상위 레벨 도메인 (TLD)을 갖는 TLD 서버 IP 주소를 로컬 DNS 서버에게 보냄
   - `COM` 을 갖는 곳
4. 로컬 DNS 서버는 TLD 서버중 하나에 접속
5. TLD 서버는 도메인을 가진 책임 DNS 서버의 IP 주소를 로컬 DNS서버에게 전송
   - 도메인은 `NAVER.COM`
   - 일반적으로 TLD 서버는 책인 DNS 서버를 아는 것이 아닌 책임 DNS 서버를 아는 중간 DNS 서버를 알고 있음
6. 로컬 DNS 서버는 직접 책임서버 중에 하나에 접속
7. 책임 서버는 호스트네임(`WWW.NAVER.COM`)의 IP를 로컬 DNS 서버에게 응답
8. 로컬 DNS서버는 호스트네임에 해당하는 IP주소를 요청 호스트에게 응답

	#### DNS 캐싱 이용한 방식

- 지연 성능 향상과 네트워크의 DNS 메시지 수를 줄이기 위해 캐싱을 사용
- DNS 서버가 DNS 응답을 받았을때 그것은 로컬 메모리에 응답에 대한 정보를 저장 가능



